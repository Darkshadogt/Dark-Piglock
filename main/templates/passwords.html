<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    {% load django_simple_bulma %}
    {% load widget_tweaks %}
    {% bulma %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Piglock</title>
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <!--Loads the css file containing the styling for passwords page-->
    <link rel="stylesheet" href="{% static 'css/passwords.css' %}">
</head>
<!--Hides the scrollbar-->
<body style="overflow-x: hidden;">
    <!--Loads Boxicon and JQuery Package-->
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <div class="tile is-ancestor is-2">
        <!--Side Menu-->
        <aside class="menu mt-3 ml-3 side_menu">
            <div class="is-flex is-flex-direction-row is-align-items-center mt-2 ml-2">
                <img class="mt-2 ml-2" src="{% static 'pig_icon.png' %}" width="40" height="100">
                <span class="logo-name has-text-weight-bold is-family-monospace has-text-white ml-2 mt-2">Dark Piglock</span>
            </div>
            <p class="menu-label has-text-white is-family-monospace mt-5 ml-2">General</p>
            <ul class="menu-list menulist mt-5 ml-2">
                <li>
                    <a class="icon-text is-family-monospace has-text-white is-family-monospace is-flex is-align-items-center" href="/dashboard/">
                        <span class="icon mt-2 mr-3">
                            <box-icon name='dashboard' type='solid' color='#ffffff' ></box-icon>
                        </span>
                        <span class="mt-2">Dashboard</span>
                    </a>
                </li>
                <li>
                    <a class="icon-text has-text-white is-family-monospace is-flex is-align-items-center" href="/passwords/">
                        <span class="icon mt-2 mr-3">
                            <box-icon name='lock' type='solid' color='#ffffff' ></box-icon>
                        </span>
                        <span class="mt-2">Passwords</span>
                    </a>
                </li>
                <li>
                    <a class="icon-text has-text-white is-family-monospace is-flex is-align-items-center" href="/notes/">
                        <span class="icon mt-2 mr-3">
                            <box-icon name='edit' color='#ffffff' ></box-icon>
                        </span>
                        <span class="mt-2">Notes</span>
                    </a>
                </li>
                <li>
                    <a class="icon-text has-text-white is-family-monospace is-flex is-align-items-center" href="/cards/">
                        <span class="icon mt-2 mr-3">
                            <box-icon name='credit-card' type='solid' color='#ffffff' ></box-icon>
                            </span>
                        <span class="mt-2">Credit Cards</span>
                    </a>
                </li>
                <li>
                    <a class="icon-text has-text-white is-family-monospace is-flex is-align-items-center" href="/history/">
                        <span class="icon mt-2 mr-3">
                            <box-icon name='history' color='#ffffff'></box-icon>
                        </span>
                        <span class="mt-2">History</span>
                    </a>
                </li>
                <li>
                    <a class="icon-text has-text-white is-family-monospace is-flex is-align-items-center" href="/settings/">
                        <span class="icon mt-2 mr-3">
                            <box-icon name='cog' color='#ffffff' ></box-icon>
                        </span>
                        <span class="mt-2">Settings</span>
                    </a>
                </li>
            </ul>
            <p class="menu-label has-text-white is-family-monospace mt-5 ml-2">Tools</p>
            <ul class="menu-list menulist mt-5 ml-2">
                <li>
                    <a class="icon-text has-text-white is-family-monospace is-flex is-align-items-center" href="/password-generator/">
                        <span class="icon mt-2 mr-3">
                            <box-icon name='refresh' color='#ffffff' ></box-icon>
                        </span>
                        <span class="mt-2">Password Generator</span>
                    </a>
                </li>
            </ul>
        </aside>
        </div>
    </div>
    <div class="main_content">
        <!--Navigation Bar-->
        <nav class="navbar custom_navbar is-fixed-top">
            <div class="navbar-menu">
                <div class="navbar-end">
                    <div class="navbar-item has-dropdown" id="dropdown">
                        <a class="navbar-link is-family-monospace">{{ username }}</a>
                        <div class="navbar-dropdown custom_dropdown">
                            <a class="navbar-item is-family-monospace" onclick="openModal('credits')">
                                Credits
                            </a>
                            <a class="navbar-item is-family-monospace" href="{% url 'logout' %}">
                                Log Out
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <!--Attribution Modal-->
        <div class="modal" id="credits" style="width: 400px; height: 450px; position: fixed; top: 55%; left: 55%; transform: translate(-50%, -50%); z-index: 5;">
            <div class="modal-background"></div>
            <div class="modal-content" style="background-color: black; text-align: center; margin-top: 30px;">
                <h1 style="color: white; font-family: monospace; font-size: 20px; margin-bottom: 20px;">Credits</h1>
                <a href="https://www.freepik.com/free-vector/gradient-black-background-with-wavy-lines_19852122.htm#query=dark%20theme%20vector%20background&position=8&from_view=search&track=ais&uuid=5fa2d0fc-99ae-437f-a630-cc21610266c7" style="color: white; font-family: monospace; text-decoration: underline;">Login Page and Sign Up Page Background Image by Freepik</a>
                <br>
                <a href="https://www.freepik.com/free-vector/background-luxury-minimalist-gradient-style-design_32582886.htm#page=2&query=dark%20vector%20background&position=30&from_view=search&track=ais&uuid=0b077dd1-421b-47da-a2d2-b748ddbd193a" style="color: white; font-family: monospace; text-decoration: underline;">Credit Card Background Image by arrandera</a>
                <br>
                <div style="font-family: monospace; color: white;"> Credit Card Chip Icon made by <a href="https://www.flaticon.com/free-icon/chip_9405771?term=credit+card+chip&page=1&position=20&origin=search&related_id=9405771" style="color: white; font-family: monospace; text-decoration: underline;" title="Freepik"> Freepik </a> from <a href="https://www.flaticon.com/" title="Flaticon" style="color: white; font-family: monospace; text-decoration: underline;">www.flaticon.com'</a></div>
                <a href="https://www.freepik.com/icon/animal-rights_2865584#fromView=search&term=pig+lock&track=ais&page=1&position=31&uuid=3f7dfbf6-5dbb-4b17-812a-f2923c1652ca" style="color: white; font-family: monospace; text-decoration: underline;">Password Page Icon by Freepik</a>
                <br>
                <a href="https://icons8.com/icon/qudcNstH1hBC/pig" style="color: white; font-family: monospace; text-decoration: underline;">Website Pig Icon made by Vitaly Gorbachev on</a><a href="https://icons8.com/"style="color: white; font-family: monospace; text-decoration: underline;"> Icons8</a>
                <br>
                <a href="https://www.freepik.com/icon/book_6153987#fromView=search&term=pig+with+notebook&track=ais&page=1&position=17&uuid=06c214f7-3f84-4666-9a1f-06e42c4b8deb" style="color: white; font-family: monospace; text-decoration: underline;">Note Page Icon by Flowicon</a>
                <br>
                <div style="color: white; font-family: monospace;">Home Page Background Image by <a href="https://www.freepik.com/free-vector/gradient-black-background-with-wavy-lines_19852128.htm#query=dark%20theme%20vector&position=12&from_view=search&track=ais&uuid=5c4ba701-a1f6-4f83-bbda-6470cbea0ae8" style="color: white; font-family: monospace; text-decoration: underline;">Freepik</a></div>
                <a href="https://storyset.com/online" style="color: white; font-family: monospace; text-decoration: underline;">Home Page Illustration by Storyset</a>
                <br>
                <a href="https://www.freepik.com/icon/no-pork_9958719" style="color: white;  font-family: monospace; text-decoration: underline;">History Page Icon by Freepik</a>
                <div class="field is-grouped-centered is-grouped" style="margin-top: 10px;">
                    <div class="control">
                        <button class="button is-family-monospace" type="button" style="width: 100px; margin-top: 20px; background-color: transparent; color: white;" onclick="closeModal('credits')">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="columns is-multiline">
            <div class="column top_column is-11">
                <!--Header box-->
                <div class="level">
                    <div class="level-left">
                        <div class="level-item ml-4 move_top">
                            <div class="has-text-white is-family-monospace has-text-weight-bold">All Passwords</div>
                        </div>
                        <div class="level-item">
                            <div class="control has-icons-left mr-6 move_top" style="margin-left: 150px;">
                                <!--If search_term is none, don't show anything in the search bar-->
                                {% if search_term == None %}
                                    <input class="input is-family-monospace" type="text" placeholder="Search" id="search_bar">
                                {% else %}
                                    <input class="input is-family-monospace" type="text" placeholder="Search" id="search_bar" value="{{ search_term }}">
                                {% endif %}
                                <span class="icon is-left ml-1">
                                    <box-icon name='search' color='#ffffff'></box-icon>
                                </span>
                            </div>
                        </div>
                        <div class="level-item" style="height: 10px; margin-top: -52px; margin-left: -40px;">
                            <select class="type-dropdown is-family-monospace" style="height: 35px; border-radius: 5px; background-color: transparent; color: white; border-color: white;" id="type_dropdown">
                                <option value="">Type</option>
                                <option value="website_name">Website Name</option>
                                <option value="username">Username</option>
                                <option value="email">Email</option>
                                <option value="website_url">Website URL</option>
                                <option value="description">Description</option>
                            </select>
                        </div>
                        {% if search_type %}
                            <script>
                                document.addEventListener('DOMContentLoaded', () => {
                                    var type_dropdown = document.getElementById('type_dropdown');
                                    type_dropdown.value = "{{ search_type }}";
                                });
                            </script>
                        {% endif %}
                    </div>
                    <div class="level-right">
                        <div class="level-item move_top">
                            <button class="button add_password_button mr-4" onclick="openModal('add_password_modal')"> 
                                <span class="icon">
                                    <box-icon name='plus' color='#ffffff' ></box-icon>
                                </span>
                                <span class="is-family-monospace">Add New</span>
                            </button>
                            <!--Add password modal, including the add password form-->
                            <div class="modal add_password_modal" id="add_password_modal">
                                <div class="modal-background"></div>
                                <div class="modal-content has-text-white is-family-monospace">
                                    <div id="add_password_form_container">
                                        <form method="post" action="{% url 'passwords' %}" id="add_password_form" onsubmit="event.preventDefault(); add_password();">
                                            {% csrf_token %}
                                            <input type="hidden" value="addPasswordForm" name="form_type">
                                            <div class="field" style="margin-top: 30px;">
                                                <p class="subtitle is-family-monospace has-text-centered is-size-4 has-text-weight-bold has-text-white">Add Password</p>
                                            </div>
                                            <!--If there are errors, display them-->
                                            {% if addForm.errors %}
                                                <div class="notification" style="width: 400px; margin-left: 50px; margin-top: 20px;">
                                                    <button class="delete" type="button" onclick="this.parentElement.style.display='none'"></button>
                                                    <strong style="color: black; font-size: 18px;">Error:</strong>
                                                    <ul class="has-text-weight-light" style="color: black; font-size: 15px;">
                                                        {% for error_list in addForm.errors.values %}
                                                            {% for error in error_list %}
                                                                <li>{{ error }}</li>
                                                            {% endfor %}
                                                        {% endfor %}
                                                    </ul>
                                                </div>
                                            {% endif %}
                                            <!--Fields of the form-->
                                            <div class="field">
                                                <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                                    Website Name
                                                </label>
                                                <div class="control">
                                                    {{ addForm.website_name }}
                                                </div>
                                            </div>
                                            <div class="field">
                                                <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                                    Website Link
                                                </label>
                                                <div class="control">
                                                    {{ addForm.website_url }}
                                                </div>
                                            </div>
                                            <div class="field">
                                                <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                                    Email
                                                </label>
                                                <div class="control">
                                                    {{ addForm.email }}
                                                </div>
                                            </div>
                                            <div class="field">
                                                <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                                    Username
                                                </label>
                                                <div class="control">
                                                    {{ addForm.username }}
                                                </div>
                                            </div>
                                            <div class="field">
                                                <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                                    Password
                                                </label>
                                                <div class="control">
                                                    {{ addForm.password }}
                                                    <button class="button" type="button" onclick="add_toggle_password()" onfocus="this.blur();" style="background-color: transparent; height: 10px; width: 10px; border: none; margin-top: -72.5px; margin-left: 130px;">
                                                        <span class="icon" id="add_password_icon" style="font-size: 15px;">
                                                            <box-icon name='hide' color='#ffffff' ></box-icon>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="field">
                                                <label class="label is-family-monospace has-text-white" style="margin-top: 10px; margin-left: 50px;">
                                                    Short Description
                                                </label>
                                                <div class="control">
                                                    {{ addForm.short_description }}
                                                </div>
                                            </div>
                                            <div class="field">
                                                <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                                    Detailed Description
                                                </label>
                                                <div class="control">
                                                    {{ addForm.detailed_description }}
                                                </div>
                                            </div>
                                            <div class="field is-grouped-centered is-grouped">
                                                <div class="control">
                                                    <button class="button is-family-monospace" type="reset" onclick="closeModal('add_password_modal')" style="width: 120px; margin-top: 20px; background-color: transparent; color: white;">
                                                        Cancel
                                                    </button>
                                                </div>
                                                <div class="control">
                                                    <button class="button is-family-monospace" type="submit" onclick="closeModal('add_password_modal')" style="width: 120px; margin-top: 20px; background-color: transparent; color: white;">
                                                        Add
                                                    </button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="modal" id="add_password_alert" style="width: 300px; height: 220px; position: fixed; top: 55%; left: 55%; transform: translate(-50%, -50%); background-color: black;">
                                <div class="modal-background"></div>
                                <div class="modal-content">
                                    <p style="margin-top: 60px; color: white; font-family: monospace; text-align: center;">Password successfully added</p>
                                    <div class="field is-grouped-centered is-grouped" style="margin-top: 40px;">
                                        <div class="control">
                                            <button class="button is-family-monospace" type="button" style="width: 100px; margin-top: 20px; background-color: transparent; color: white;" onclick="closeModal('add_password_alert')">
                                                Close
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="divider"></div>
            </div>
        </div>
        <div class="columns is-multiline" id="passwordContainer">
            <!--Looping through each password the user created-->
            {% if user_passwords %}
                {% for password, editForm in user_passwords %}
                    <div class="column is-3" style="margin-top: 10px; margin-left: 65px;">
                        <div class="box has-background-black" style="height: 150px; border-radius: 10px;">
                            <div class="has-text-weight-bold" style="color:white; font-size: 20px; margin-top: 20px; margin-left: 80px;">{{ password.website_name }}</div>
                            {% if password.website_url %}
                                <div style="font-size: 10px; margin-left: 82.5px; color: white; margin-top: 1px;">{{ password.website_url }}</div>
                            {% else %}
                                <div style="font-size: 10px; margin-left: 82.5px; color: white; margin-top: 1px; visibility: hidden;">none</div>
                            {% endif %}
                            <img src="{% static 'pig_lock.png' %}" style="margin-left: 10px; margin-top: -65px;">
                            <!--Creates a dropdown for the settings menu-->
                            <div class="dropdown" style="margin-top: 40px;">
                                <div class="dropdown-trigger">
                                    <button class="button"  onfocus="this.blur();" style="background-color: transparent; height: 10px; width: 10px; border: none; margin-top: -130px; margin-left: 182.5px;">
                                        <span class="icon" style="font-size: 20px;">
                                            <box-icon name='chevron-down' color='#ffffff' size='lg'></box-icon>
                                        </span>
                                    </button>
                                </div>
                                <!--Settings menu for each password-->
                                <div class="dropdown-menu" style="margin-top: -138.5px; margin-left: 180px;">
                                    <div class="dropdown-content">
                                        <a class="dropdown-item is-family-monospace" onclick="openModal('view_password_modal_{{ password.id }}')">
                                            View
                                        </a>
                                        <a class="dropdown-item is-family-monospace" onclick="openModal('edit_password_modal_{{ password.id }}')">
                                            Edit
                                        </a>
                                        <a class="dropdown-item is-family-monospace" onclick="delete_password('{{ password.id }}')">
                                            Delete
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--View Password Modal-->
                    <div class="modal" id="view_password_modal_{{ password.id }}" style="width: 500px; height: 500px; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                        <div class="modal-background"></div>
                        <div class="modal-content has-text-white is-family-monospace">
                            <div class="field" style="margin-top: 20px;">
                                <p class="subtitle is-family-monospace has-text-centered is-size-4 has-text-weight-bold has-text-white">{{ password.website_name }}</p>
                            </div>
                            <div class="field">
                                <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                    Username
                                </label>
                                <input class="input is-family-monospace" type="text" value="{{ password.get_username }}" style="width: 400px; margin-top: 10px; margin-left: 50px;" readonly>
                            </div>
                            <div class="field">
                                <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                    Password
                                </label>
                                <input id="view_password_modal_{{ password.id }}_password" class="input is-family-monospace" type="password" value="{{ password.get_password }}" style="width: 400px; margin-top: 10px; margin-left: 50px;" readonly>
                                <button class="button" type="button" onclick="view_toggle_password('{{password.id}}')" onfocus="this.blur();" style="background-color: transparent; height: 10px; width: 10px; border: none; margin-top: -72.5px; margin-left: 130px;">
                                    <span class="icon" id="{{password.id}}_icon" style="font-size: 15px;">
                                        <box-icon name='hide' color='#ffffff' ></box-icon>
                                    </span>
                                </button>
                            </div>
                            <div class="field">
                                <label class="label is-family-monospace has-text-white" style="margin-top: 10px; margin-left: 50px;">
                                    Email
                                </label>
                                <input class="input is-family-monospace" type="text"  value="{{ password.get_email }}" style="width: 400px; margin-top: 10px; margin-left: 50px;" readonly>
                            </div>
                            <div class="field">
                                <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                    Website Link
                                </label>
                                <input class="input is-family-monospace" type="text" value="{{ password.website_url }}" style="width: 400px; margin-top: 10px; margin-left: 50px;" readonly>
                            </div>
                            <div class="field">
                                <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                    Short Description
                                </label>
                                <input class="input is-family-monospace" type="text" value="{{ password.short_description }}" style="width: 400px; margin-top: 10px; margin-left: 50px;" readonly>
                            </div>
                            <div class="field" style="width: 400px;">
                                <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                    Detailed Description
                                </label>
                                <textarea class="textarea is-family-monospace" type="text" style="margin-top: 10px; margin-left: 50px; background-color: transparent;" readonly>{{ password.detailed_description }}</textarea>
                            </div>
                        </div>
                        <button class="modal-close is-large" type="button" onclick="closeModal('view_password_modal_{{ password.id }}')"></button>
                    </div>
                    <!--Edit Password Modal-->
                    <div class="modal" id="edit_password_modal_{{ password.id }}" style="width: 500px; height: 500px; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                        <div class="modal-background"></div>
                        <div class="modal-content has-text-white is-family-monospace">
                            <div id="edit_password_form_container_{{ password.id }}">
                                <form method="post" action="{% url 'passwords' %}" onsubmit="event.preventDefault(); edit_password(this);">
                                    {% csrf_token %}
                                    <input type="hidden" value="editPasswordForm" name="form_type">
                                    <input type="hidden" value="{{ password.id }}" name="password_id">
                                    <div class="field" style="margin-top: 30px;">
                                        <p class="subtitle is-family-monospace has-text-centered is-size-4 has-text-weight-bold has-text-white">Edit Password</p>
                                    </div>
                                    {% if editForm.errors %}
                                        <div class="notification" style="width: 400px; margin-left: 50px; margin-top: 20px;" id="edit_password_modal_notification_{{ password.id }}">
                                            <button class="delete" type="button" onclick="closeNotification('{{ password.id }}')"></button>
                                            <strong style="color: black; font-size: 18px;">Error:</strong>
                                            <ul class="has-text-weight-light" style="color: black; font-size: 15px;">
                                                {% for error_list in editForm.errors.values %}
                                                    {% for error in error_list %}
                                                        <li>{{ error }}</li>
                                                    {% endfor %}
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    {% endif %}
                                    <div class="field">
                                        <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                            Website Name
                                        </label>
                                        <div class="control">
                                            {% render_field editForm.website_name value=password.website_name %}
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                            Website Link
                                        </label>
                                        <div class="control">
                                            {% render_field editForm.website_url value=password.website_url %}
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                            Email
                                        </label>
                                        <div class="control">
                                            {% render_field editForm.email value=password.get_email %}
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                            Username
                                        </label>
                                        <div class="control">
                                            {% render_field editForm.username value=password.get_username %}
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                            Password
                                        </label>
                                        <div class="control">
                                            <input class="input is-family-monospace" style="width: 400px; margin-top: 10px; margin-left: 50px" value="{{ password.get_password }}" id="edit_password_modal_{{ password.id }}_password" type="password" name="editForm_password">
                                            <button class="button" type="button" onclick="edit_toggle_password('{{ password.id }}')" onfocus="this.blur();" style="background-color: transparent; height: 10px; width: 10px; border: none; margin-top: -72.5px; margin-left: 130px;">
                                                <span class="icon" id="{{ password.id }}_icon" style="font-size: 15px;">
                                                    <box-icon name='hide' color='#ffffff' ></box-icon>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label is-family-monospace has-text-white" style="margin-top: 10px; margin-left: 50px;">
                                        Short Description
                                        </label>
                                        <div class="control">
                                            {% render_field editForm.short_description value=password.short_description %}
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label is-family-monospace has-text-white" style="margin-top: 30px; margin-left: 50px;">
                                            Detailed Description
                                        </label>
                                        <div class="control">
                                            {% render_field editForm.detailed_description value=password.detailed_description %}
                                        </div>
                                    </div>
                                    <div class="field is-grouped-centered is-grouped">
                                        <div class="control">
                                            <button class="button is-family-monospace" type="reset" onclick="closeModal('edit_password_modal_{{ password.id }}');" style="width: 120px; margin-top: 20px; background-color: transparent; color: white;">
                                                Cancel
                                            </button>
                                        </div>
                                        <div class="control">
                                            <button class="button is-family-monospace" type="submit" onclick="closeModal('edit_password_modal_{{ password.id }}')" style="width: 120px; margin-top: 20px; background-color: transparent; color: white;">
                                                Save
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
        <!--Pagination below the page-->
        <div id="paginationContainer">
            {% if user_passwords %}
                <nav class="pagination is-centered">
                    {% if user_passwords.has_previous %}
                        <a href="?page={{ user_passwords.previous_page_number }}" onclick="event.preventDefault(); page_update(this);" class="pagination-previous">
                            <box-icon name='chevron-left' color='#ffffff' ></box-icon>
                        </a>
                    {% else %}
                        <a class="pagination-previous is-disabled">
                            <box-icon name='chevron-left' color='#ffffff' ></box-icon>
                        </a>
                    {% endif %}
                
                    <ul class="pagination-list" >
                        {% for i in user_passwords.paginator.page_range %}
                            {% if user_passwords.number == i %}
                                <li>
                                    <span class="pagination-link is-current has-text-white">{{ i }}</span>
                                </li>
                            {% elif i > user_passwords.number|add:"-3" and i < user_passwords.number|add:"3" %}
                                <li>
                                    <a href="?page={{ i }}"  onclick="event.preventDefault(); page_update(this);" class="pagination-link has-text-white">{{ i }}</a>
                                </li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                
                    {% if user_passwords.has_next %}
                        <a href="?page={{ user_passwords.next_page_number }}" onclick="event.preventDefault(); page_update(this);" class="pagination-next">
                            <box-icon name='chevron-right' color='#ffffff' ></box-icon>
                        </a>
                    {% else %}
                        <a class="pagination-next is-disabled">
                            <box-icon name='chevron-right' color='#ffffff' ></box-icon>
                        </a>
                    {% endif %}
                </nav>
            {% endif %}
        </div>
    <script>
        /* Toggle the password visibility for adding passwords */
        function add_toggle_password(){
            var passwordInput = document.getElementById('add_password_input');
            var toggleIcon = document.getElementById("add_password_icon");
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.innerHTML = '<box-icon name="show" color="#ffffff"></box-icon>';
            } else {
                passwordInput.type = 'password';
                toggleIcon.innerHTML = '<box-icon name="hide" color="#ffffff"></box-icon>';
            }
        }

        /* Toggle the password visibility for viewing each password */
        function view_toggle_password(id){
            var passwordInput = document.getElementById('view_password_modal_' + id + '_password');
            var toggleIcon = document.getElementById(id + "_icon");
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.innerHTML = '<box-icon name="show" color="#ffffff"></box-icon>';
            } else {
                passwordInput.type = 'password';
                toggleIcon.innerHTML = '<box-icon name="hide" color="#ffffff"></box-icon>';
            }
        }

        /* Toggle the password visibility for editting each password */
        function edit_toggle_password(id){
            var passwordInput = document.getElementById('edit_password_modal_' + id + '_password');
            var toggleIcon = document.getElementById(id + "_icon");
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.innerHTML = '<box-icon name="show" color="#ffffff"></box-icon>';
            } else {
                passwordInput.type = 'password';
                toggleIcon.innerHTML = '<box-icon name="hide" color="#ffffff"></box-icon>';
            }
        }

        /* Adds password to page */
        function add_password() {
            var currentPage = $('#paginationContainer .pagination-link.is-current').text();
            $.ajax({
                type: "POST",
                url: "{% url 'passwords' %}?page=" + currentPage,
                data: $('#add_password_form').serialize(),
                success: function(response) {
                    /* If form does not have error, update the pagination */
                    if (response.status == "success") {
                        $('#passwordContainer').html($(response.password_list_html));
                        $('#add_password_form_container').html($(response.add_password_form_html));
                        $.ajax({
                            type: "GET",
                            url: "{% url 'passwords' %}",
                            data: { 'page': response.page, 'form_type': 'paginationForm'}, 
                            success: function(response) {
                                $('#paginationContainer').html($(response.pagination_html));
                                openModal('add_password_alert');
                            },
                            error: function(xhr, status, error) {
                                console.error("Error updating pagination:", status, error);
                            }
                        });
                    /* If form has error, open the modal */
                    } else {
                        $('#add_password_form_container').html($(response.add_password_form_html));
                        openModal("add_password_modal");
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Error adding password:", status, error);
                }
            });
        }
        
        /* Edits the password information */
        function edit_password(editForm) {
            var currentPage = $('#paginationContainer .pagination-link.is-current').text();
            $.ajax({
                type: "POST",
                url: "{% url 'passwords' %}",
                data: $(editForm).serialize() + "&currentPage=" + currentPage, 
                success: function(response) {
                    /* If the form doesn't have error, update current page */
                    if (response.status == "success") {
                        $('#passwordContainer').html($(response.password_list_html));
                    
                    /* If form has error, open the modal*/
                    } else {
                        $('#edit_password_form_container_' + response.password_id).html($(response.edit_password_form_html));
                        openModal("edit_password_modal_" + response.password_id);
                    }
                },
                error: function(xhr, status, error) {
                    console.error("Error updating page:", status, error);
                }
            });
        }

        /* Sends a form with the id to delete the password */
        function delete_password(id){
            var currentPage = $('#paginationContainer .pagination-link.is-current').text();
            $.ajax({
                type: "GET",
                url: "{% url 'passwords' %}",
                data: {'form_type': 'deletePasswordForm', 'password_to_delete_id':id, 'currentPage':currentPage}, 
                success: function(response) {
                    $('#passwordContainer').html($(response.password_list_html));
                    $('#paginationContainer').html($(response.pagination_html))
                },
                error: function(xhr, status, error) {
                    console.error("Error updating page:", status, error);
                }
            });
        }

        /* Updates the password list based on page number */
        function page_update(pagination_button) {
            var page = $(pagination_button).attr("href").split("=")[1];
            $.ajax({
                type: "GET",
                url: "{% url 'passwords' %}",
                data: {'page': page, 'form_type': 'page_updateForm'}, 
                success: function(response) {
                    $('#passwordContainer').html($(response.password_list_html));
                    $.ajax({
                        type: "GET",
                        url: "{% url 'passwords' %}",
                        data: {'page': page, 'form_type': 'paginationForm'}, 
                        success: function(response) {
                            $('#paginationContainer').html($(response.pagination_html));
                        },
                        error: function(xhr, status, error) {
                            console.error("Error updating pagination:", status, error);
                        }
                    });
                },
                error: function(xhr, status, error) {
                    console.error("Error updating pagination:", status, error);
                }
            });
        }
        
        /* Opening modal */
        function openModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.add('is-active');
            }
        }
        
        /* Closing modal */
        function closeModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.remove('is-active');
            }
        }

        /* Closing edit form notification */
        function closeNotification(id){
            const notification = document.getElementById("edit_password_modal_notification_" + id);
            if (notification) {
                notification.remove();
            }
        }
        
        /* Toggling dropdowns */
        document.addEventListener('DOMContentLoaded', () => {
            const navDropdown = document.getElementById('dropdown');
            const passwordContainer = document.getElementById('passwordContainer');
            const searchBar = document.getElementById('search_bar');
            const type_dropdown = document.getElementById('type_dropdown');

            navDropdown.addEventListener('click', () => {
                navDropdown.classList.toggle('is-active');
            });
            
            passwordContainer.addEventListener('click', (event) => {
                const targetDropdown = event.target.closest('.dropdown');
                
                if (targetDropdown) {
                    targetDropdown.classList.toggle('is-active');
                }
            });

            /* Sends a form with the search term to update the displayed passwords */
            searchBar.addEventListener("keypress", function(event) {
                if (event.key == "Enter") {
                    $.ajax({
                        type: "GET",
                        url: "{% url 'passwords' %}",
                        data: {'form_type': 'searchForm', 'search_term':searchBar.value, 'search_type':type_dropdown.value}, 
                        success: function(response) {
                            $('#passwordContainer').html($(response.password_list_html));
                            $('#paginationContainer').html($(response.pagination_html))
                        },
                        error: function(xhr, status, error) {
                            console.error("Error updating page:", status, error);
                        }
                    });
                }
            });
        });

    </script>
</body>
</html>